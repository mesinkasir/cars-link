{"version":3,"file":"index.es.js","sources":["../src/Combobox.styles.ts","../src/Combobox.tsx"],"sourcesContent":["import { Data } from '@udecode/plate-combobox';\nimport { createStyles } from '@udecode/plate-styled-components';\nimport { css } from 'styled-components';\nimport tw from 'twin.macro';\nimport { ComboboxStyleProps } from './Combobox.types';\n\nexport const getComboboxStyles = <TData extends Data>(\n  props: ComboboxStyleProps<TData>\n) => {\n  const item = [\n    tw`flex items-center px-2 cursor-pointer`,\n    css`\n      font-size: 14px;\n      border-radius: 0;\n      min-height: 36px;\n      user-select: none;\n      color: rgb(32, 31, 30);\n    `,\n  ];\n\n  return createStyles({ prefixClassNames: 'Combobox', ...props }, [\n    {\n      root: [\n        tw`bg-white m-0 p-0 overflow-scroll`,\n        css`\n          width: 300px;\n          max-height: 288px;\n          border-radius: 0 0 2px 2px;\n          box-shadow: rgba(0, 0, 0, 0.133) 0 3.2px 7.2px 0,\n            rgba(0, 0, 0, 0.11) 0 0.6px 1.8px 0;\n\n          z-index: 500;\n        `,\n      ],\n      item: [\n        ...item,\n        css`\n          background: transparent;\n\n          :hover {\n            background: rgb(243, 242, 241);\n          }\n        `,\n      ],\n      highlightedItem: [\n        ...item,\n        css`\n          background: rgb(237, 235, 233);\n\n          :hover {\n            background: rgb(237, 235, 233);\n          }\n        `,\n      ],\n    },\n  ]);\n};\n","import React, { useCallback, useEffect } from 'react';\nimport {\n  comboboxActions,\n  comboboxSelectors,\n  Data,\n  getComboboxStoreById,\n  NoData,\n  TComboboxItem,\n  useActiveComboboxStore,\n  useComboboxControls,\n  useComboboxSelectors,\n} from '@udecode/plate-combobox';\nimport {\n  isDefined,\n  useEditorState,\n  useEventEditorSelectors,\n} from '@udecode/plate-core';\nimport { PortalBody } from '@udecode/plate-styled-components';\nimport {\n  getRangeBoundingClientRect,\n  usePopperPosition,\n  virtualReference,\n} from '@udecode/plate-ui-popper';\nimport { getComboboxStyles } from './Combobox.styles';\nimport { ComboboxProps } from './Combobox.types';\n\nconst ComboboxContent = <TData extends Data = NoData>(\n  props: Pick<ComboboxProps<TData>, 'component' | 'items' | 'onRenderItem'>\n) => {\n  const { component: Component, items, onRenderItem } = props;\n\n  const targetRange = useComboboxSelectors.targetRange();\n  const filteredItems = useComboboxSelectors.filteredItems();\n  const highlightedIndex = useComboboxSelectors.highlightedIndex();\n  const popperContainer = useComboboxSelectors.popperContainer?.();\n  const popperOptions = useComboboxSelectors.popperOptions?.();\n  const editor = useEditorState();\n  const combobox = useComboboxControls();\n  const activeComboboxStore = useActiveComboboxStore()!;\n  const text = useComboboxSelectors.text();\n  const storeItems = useComboboxSelectors.items();\n  const filter = activeComboboxStore.use.filter?.();\n  const maxSuggestions =\n    activeComboboxStore.use.maxSuggestions?.() ?? storeItems.length;\n\n  const popperRef = React.useRef<any>(null);\n\n  // Update items\n  useEffect(() => {\n    items && comboboxActions.items(items);\n  }, [items]);\n\n  // Filter items\n  useEffect(() => {\n    if (!isDefined(text)) return;\n\n    if (text.length === 0) {\n      return comboboxActions.filteredItems(storeItems.slice(0, maxSuggestions));\n    }\n\n    const _filteredItems = storeItems\n      .filter(\n        filter\n          ? filter(text)\n          : (value) => value.text.toLowerCase().startsWith(text.toLowerCase())\n      )\n      .slice(0, maxSuggestions);\n\n    comboboxActions.filteredItems(_filteredItems);\n  }, [filter, storeItems, maxSuggestions, text]);\n\n  // Get target range rect\n  const getBoundingClientRect = useCallback(\n    () => getRangeBoundingClientRect(editor, targetRange) ?? virtualReference,\n    [editor, targetRange]\n  );\n\n  // Update popper position\n  const { styles: popperStyles, attributes } = usePopperPosition({\n    popperElement: popperRef.current,\n    popperContainer,\n    popperOptions,\n    placement: 'bottom-start',\n    getBoundingClientRect,\n    offset: [0, 4],\n  });\n\n  const menuProps = combobox\n    ? combobox.getMenuProps({}, { suppressRefError: true })\n    : { ref: null };\n\n  const { root, item: styleItem, highlightedItem } = getComboboxStyles(\n    props as any\n  );\n\n  return (\n    <PortalBody>\n      <ul\n        {...menuProps}\n        ref={popperRef}\n        style={popperStyles.popper}\n        css={root.css}\n        className={root.className}\n        {...attributes.popper}\n      >\n        {Component ? Component({ store: activeComboboxStore }) : null}\n\n        {filteredItems.map((item, index) => {\n          const Item = onRenderItem\n            ? onRenderItem({ item: item as TComboboxItem<TData> })\n            : item.text;\n\n          const highlighted = index === highlightedIndex;\n\n          return (\n            <div\n              key={item.key}\n              css={!highlighted ? styleItem?.css : highlightedItem?.css}\n              className={\n                !highlighted ? styleItem?.className : highlightedItem?.css\n              }\n              {...combobox.getItemProps({\n                item,\n                index,\n              })}\n              onMouseDown={(e) => {\n                e.preventDefault();\n\n                const onSelectItem = getComboboxStoreById(\n                  comboboxSelectors.activeId()\n                )?.get.onSelectItem();\n                onSelectItem?.(editor, item);\n              }}\n            >\n              {Item}\n            </div>\n          );\n        })}\n      </ul>\n    </PortalBody>\n  );\n};\n\n/**\n * Register the combobox id, trigger, onSelectItem\n * Renders the combobox if active.\n */\nexport const Combobox = <TData extends Data = NoData>({\n  id,\n  trigger,\n  searchPattern,\n  onSelectItem,\n  controlled,\n  ...props\n}: ComboboxProps<TData>) => {\n  const editor = useEditorState();\n  const focusedEditorId = useEventEditorSelectors.focus?.();\n  const combobox = useComboboxControls();\n  const activeId = useComboboxSelectors.activeId();\n\n  useEffect(() => {\n    comboboxActions.setComboboxById({\n      id,\n      trigger,\n      searchPattern,\n      controlled,\n      onSelectItem,\n    });\n  }, [id, trigger, searchPattern, controlled, onSelectItem]);\n\n  if (\n    !combobox ||\n    !editor.selection ||\n    focusedEditorId !== editor.id ||\n    activeId !== id\n  ) {\n    return null;\n  }\n\n  return <ComboboxContent {...props} />;\n};\n"],"names":["getComboboxStyles","props","item","css","createStyles","prefixClassNames","root","highlightedItem","ComboboxContent","component","Component","items","onRenderItem","targetRange","useComboboxSelectors","filteredItems","highlightedIndex","popperContainer","popperOptions","editor","useEditorState","combobox","useComboboxControls","activeComboboxStore","useActiveComboboxStore","text","storeItems","filter","use","maxSuggestions","length","popperRef","React","useRef","useEffect","comboboxActions","isDefined","slice","_filteredItems","value","toLowerCase","startsWith","getBoundingClientRect","useCallback","getRangeBoundingClientRect","virtualReference","styles","popperStyles","attributes","usePopperPosition","popperElement","current","placement","offset","menuProps","getMenuProps","suppressRefError","ref","styleItem","popper","className","store","map","index","Item","highlighted","key","getItemProps","e","preventDefault","onSelectItem","getComboboxStoreById","comboboxSelectors","activeId","get","Combobox","id","trigger","searchPattern","controlled","focusedEditorId","useEventEditorSelectors","focus","setComboboxById","selection"],"mappings":"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"}