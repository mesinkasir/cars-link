{"version":3,"file":"index.es.js","sources":["../src/createSelectOnBackspacePlugin.ts"],"sourcesContent":["import {\n  isCollapsed,\n  queryNode,\n  QueryNodeOptions,\n} from '@udecode/plate-common';\nimport {\n  getPlatePluginWithOverrides,\n  TNode,\n  WithOverride,\n} from '@udecode/plate-core';\nimport Slate, { Editor, Transforms } from 'slate';\n\nexport type SelectOnBackspacePluginOptions = QueryNodeOptions;\nexport type WithSelectOnBackspaceOptions = SelectOnBackspacePluginOptions;\n\n/**\n * Set a list of element types to select on backspace\n */\nexport const withSelectOnBackspace = (\n  query: WithSelectOnBackspaceOptions\n): WithOverride => (editor) => {\n  const { deleteBackward } = editor;\n\n  editor.deleteBackward = (unit: 'character' | 'word' | 'line' | 'block') => {\n    const { selection } = editor;\n    if (unit === 'character' && isCollapsed(selection)) {\n      const prevNode = Editor.before(editor, selection as Slate.Location, {\n        unit,\n      });\n      if (prevNode) {\n        const [prevCell] = Editor.nodes<TNode>(editor, {\n          match: (node) => queryNode([node as TNode, prevNode.path], query),\n          at: prevNode,\n        });\n\n        if (!!prevCell && prevNode) {\n          // don't delete image, set selection there\n          Transforms.select(editor, prevNode);\n        } else {\n          deleteBackward(unit);\n        }\n      } else {\n        deleteBackward(unit);\n      }\n    } else {\n      deleteBackward(unit);\n    }\n  };\n\n  return editor;\n};\n\n/**\n * @see {@link withSelectOnBackspace}\n */\nexport const createSelectOnBackspacePlugin = getPlatePluginWithOverrides(\n  withSelectOnBackspace\n);\n"],"names":["withSelectOnBackspace","query","editor","deleteBackward","unit","selection","isCollapsed","prevNode","Editor","before","prevCell","nodes","match","node","queryNode","path","at","Transforms","select","createSelectOnBackspacePlugin","getPlatePluginWithOverrides"],"mappings":";;;;AAeA;AACA;AACA;MACaA,qBAAqB,GAChCC,KADmC,IAEjBC,MAAD,IAAY;AAC7B,QAAM;AAAEC,IAAAA;AAAF,MAAqBD,MAA3B;;AAEAA,EAAAA,MAAM,CAACC,cAAP,GAAyBC,IAAD,IAAmD;AACzE,UAAM;AAAEC,MAAAA;AAAF,QAAgBH,MAAtB;;AACA,QAAIE,IAAI,KAAK,WAAT,IAAwBE,WAAW,CAACD,SAAD,CAAvC,EAAoD;AAClD,YAAME,QAAQ,GAAGC,MAAM,CAACC,MAAP,CAAcP,MAAd,EAAsBG,SAAtB,EAAmD;AAClED,QAAAA;AADkE,OAAnD,CAAjB;;AAGA,UAAIG,QAAJ,EAAc;AACZ,cAAM,CAACG,QAAD,IAAaF,MAAM,CAACG,KAAP,CAAoBT,MAApB,EAA4B;AAC7CU,UAAAA,KAAK,EAAGC,IAAD,IAAUC,SAAS,CAAC,CAACD,IAAD,EAAgBN,QAAQ,CAACQ,IAAzB,CAAD,EAAiCd,KAAjC,CADmB;AAE7Ce,UAAAA,EAAE,EAAET;AAFyC,SAA5B,CAAnB;;AAKA,YAAI,CAAC,CAACG,QAAF,IAAcH,QAAlB,EAA4B;AAC1B;AACAU,UAAAA,UAAU,CAACC,MAAX,CAAkBhB,MAAlB,EAA0BK,QAA1B;AACD,SAHD,MAGO;AACLJ,UAAAA,cAAc,CAACC,IAAD,CAAd;AACD;AACF,OAZD,MAYO;AACLD,QAAAA,cAAc,CAACC,IAAD,CAAd;AACD;AACF,KAnBD,MAmBO;AACLD,MAAAA,cAAc,CAACC,IAAD,CAAd;AACD;AACF,GAxBD;;AA0BA,SAAOF,MAAP;AACD;AAED;AACA;AACA;;MACaiB,6BAA6B,GAAGC,2BAA2B,CACtEpB,qBADsE;;;;"}