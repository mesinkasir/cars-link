{"version":3,"file":"index.js","sources":["../src/deserializer/createDeserializeAstPlugin.ts"],"sourcesContent":["import {\n  getPlatePluginWithOverrides,\n  PlatePlugin,\n  WithOverride,\n} from '@udecode/plate-core';\nimport {\n  insertDeserializedFragment,\n  isDeserializerEnabled,\n} from '@udecode/plate-serializer';\n\nexport interface WithDeserializeAstOptions {\n  plugins?: PlatePlugin[];\n}\n\nexport const astDeserializerId = 'AST Deserializer';\n\n/**\n * Enables support for deserializing inserted content from Slate Ast format to Slate format\n * while apply a small bug fix.\n */\nexport const withDeserializeAst = ({\n  plugins = [],\n}: WithDeserializeAstOptions = {}): WithOverride => (editor) => {\n  const { insertData } = editor;\n\n  editor.insertData = (data: DataTransfer) => {\n    const ast = data.getData('application/x-slate-fragment');\n\n    const isEnabled = isDeserializerEnabled(editor, plugins, astDeserializerId);\n\n    if (ast && isEnabled) {\n      const decoded = decodeURIComponent(window.atob(ast));\n      const fragment = JSON.parse(decoded);\n\n      if (fragment.length) {\n        return insertDeserializedFragment(editor, { fragment, plugins });\n      }\n    }\n\n    insertData(data);\n  };\n\n  return editor;\n};\n\n/**\n * @see {@link withDeserializeAst}\n */\nexport const createDeserializeAstPlugin = getPlatePluginWithOverrides(\n  withDeserializeAst\n);\n"],"names":["astDeserializerId","withDeserializeAst","plugins","editor","insertData","data","ast","getData","isEnabled","isDeserializerEnabled","decoded","decodeURIComponent","window","atob","fragment","JSON","parse","length","insertDeserializedFragment","createDeserializeAstPlugin","getPlatePluginWithOverrides"],"mappings":";;;;;;;MAcaA,iBAAiB,GAAG;AAEjC;AACA;AACA;AACA;;MACaC,kBAAkB,GAAG,CAAC;AACjCC,EAAAA,OAAO,GAAG;AADuB,IAEJ,EAFG,KAEmBC,MAAD,IAAY;AAC9D,QAAM;AAAEC,IAAAA;AAAF,MAAiBD,MAAvB;;AAEAA,EAAAA,MAAM,CAACC,UAAP,GAAqBC,IAAD,IAAwB;AAC1C,UAAMC,GAAG,GAAGD,IAAI,CAACE,OAAL,CAAa,8BAAb,CAAZ;AAEA,UAAMC,SAAS,GAAGC,qCAAqB,CAACN,MAAD,EAASD,OAAT,EAAkBF,iBAAlB,CAAvC;;AAEA,QAAIM,GAAG,IAAIE,SAAX,EAAsB;AACpB,YAAME,OAAO,GAAGC,kBAAkB,CAACC,MAAM,CAACC,IAAP,CAAYP,GAAZ,CAAD,CAAlC;AACA,YAAMQ,QAAQ,GAAGC,IAAI,CAACC,KAAL,CAAWN,OAAX,CAAjB;;AAEA,UAAII,QAAQ,CAACG,MAAb,EAAqB;AACnB,eAAOC,0CAA0B,CAACf,MAAD,EAAS;AAAEW,UAAAA,QAAF;AAAYZ,UAAAA;AAAZ,SAAT,CAAjC;AACD;AACF;;AAEDE,IAAAA,UAAU,CAACC,IAAD,CAAV;AACD,GAfD;;AAiBA,SAAOF,MAAP;AACD;AAED;AACA;AACA;;MACagB,0BAA0B,GAAGC,qCAA2B,CACnEnB,kBADmE;;;;;;"}